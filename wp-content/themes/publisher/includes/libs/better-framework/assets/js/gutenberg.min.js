var BFGutenbergAPI=function(){var n,l={},t={},i={},r="",a={className:{removeAll:function(t,e){var r=this.remove;return e.forEach(function(e){t=r(t,e)}),t},remove:function(e,t){return e?e.replace(new RegExp("\\b"+t+"\\b","g"),"").trim():""},add:function(e,t){if(!e)return t;e=e.split(" ");return e.push(t),_.unique(e).join(" ")}}};function o(e){this.element=window.wp&&window.wp.element,this.blocks=window.wp&&window.wp.blocks,this.prefix="better-studio/",this.blockFields={},this.shortcode={},Object.defineProperty(this,"props",{get:function(){return n||e}}),this.attributes=e&&e.attributes||{},e&&e.clientId&&e.attributes&&(l[e.clientId]=e.attributes,(t[e.clientId]=e).isSelected&&(r=e.clientId))}return o.prototype.overrideBlock=function(e){this.overrideSettings=e||{}},o.prototype.registerBlockType=function(e,t){this.shortcode=e,this.blockFields=t;e=this.shortcode.block_id||this.shortcode.id.replace(/_/g,"-"),t=this.shortcode.category||"betterstudio";this.bfGutenbergCatExists(t)&&this.blocks.registerBlockType(this.prefix+e,_.extend({title:this.shortcode.name||this.shortcode.id,icon:this.blockIcon(),category:t,save:this.saveBlock.bind(this),attributes:this.blockAttributes(this.shortcode.id),example:{preview:!0}},this.overrideSettings,{edit:this.editBlock.bind(this)}))},o.prototype.saveBlock=function(e){return null},o.prototype.bfGutenbergCatExists=function(e){if(void 0===i[e]){i[e]=!1;for(var t=this.blocks.getCategories()||[],r=0;r<t.length;r++)if(t[r].slug===e){i[e]=!0;break}}return i[e]},o.prototype.blockAttributes=function(e){if(!this.blockFields)return[];var t={},r=function(e){e.id&&e.attribute&&(t[e.id]=e.attribute),e.children&&e.children.forEach(function(e){r(e)})};return this.blockFields.forEach(r),this.overrideSettings.filterAttributes&&(t=this.overrideSettings.filterAttributes(t)),t},o.prototype.editBlock=function(e){var t=e.name.replace(this.prefix,"");if(!t||t===e.name)return[];!e.isSelected&&void 0!==this.props||(this.props=e);var r=[];if(void 0!==this.overrideSettings.defaultAttributes&&!this.overrideSettings.defaultAttributes||r.push(this.buildBlockFields()),"function"==typeof this.overrideSettings.edit)return r.push(this.overrideSettings.edit(e)),r;t=!this.shortcode.click_able,e=this.element.createElement(this.getComponent("ServerSideRender"),{block:e.name,attributes:_.extend(e.attributes,{_updated:Date.now()}),key:"D2"});return t&&(e=this.element.createElement(this.getComponent("Disabled"),{key:"D1"},e)),r.push(e),r},o.prototype.buildElement=function(e,t){var r=[],i=this;return e.forEach(function(e){e.children?r.push(i.buildElement(e.children,e)):Array.isArray(e)?r.push(i.buildElement(e,t)):r.push(i.createElement(e))}),i.createElement(t,r)},o.prototype.createElement=function(e,t){var r=[];t&&t.length?r=t:e.args&&e.args.innerText&&(r=e.args.innerText);r=[this.getComponent(e.component),this.componentArgs(e)].concat(r);return this.element.createElement.apply(this.element,r)},o.prototype.componentArgs=function(o){var e=o.args||{};if("Fragment"===o.component||o.component.match(/tag_(.+)/))return e;var s=this,c="add_class"===o.action;return e.onChange=e.onChange||function(e){var t,r,i={[o.id]:e},n="";c&&(t=s.props.attributes.className,n=o.attribute&&o.attribute.enum?(n=a.className.removeAll(t,o.attribute.enum),a.className.add(n,e)):0===e||1===e?(r=o.id,a.className[1===e?"add":"remove"](t,r)):e,o.fixed_class&&(n=a.className.add(n,o.fixed_class)),i.className=n),s.props.setAttributes(i);n=s.props.clientId;return n&&(l[n]=_.extend(l[n]||{},i)),!1},e.value=this.props&&this.props.attributes[o.id]||o.std,-1===["block_fragment","inspector","edit-panel"].indexOf(e.key)&&void 0===e.value&&(e.value=""),"TreeSelect"===o.component&&(e.selectedId=e.value),e},o.prototype.buildBlockFields=function(){var e=[{id:"inspector",component:"InspectorControls",args:{key:"inspector"},children:[{id:"bf_edit_panel",component:"BF_Edit_Panel",args:{type:"edit-panel"},key:"bf_edit_panel",children:this.blockFields}]}];return this.buildElement(e,{id:"block_fragment",component:"Fragment",args:{key:"block_fragment"}})},o.prototype.getComponent=function(e){var t=e.match(/tag_(.+)/);return t?t[1]:wp.editor[e]||wp.components[e]||wp.element[e]||void 0},o.prototype.blockIcon=function(){if(this.shortcode.icon_url)return this.element.createElement("img",{src:this.shortcode.icon_url});var e="tabs"==this.shortcode.id?{icon:"admin-page"}:"align-center";return this.shortcode.icon||e.icon},{init:function(){wp.hooks&&wp.hooks.addFilter&&wp.compose&&wp.compose.createHigherOrderComponent&&(this.registerBlocks(),BF_Gutenberg.stickyFields&&(this.registerSharedFields(),this.registerSharedAttributes()))},registerBlocks:function(){var e,t;if(BF_Gutenberg&&BF_Gutenberg.blocks)for(t in BF_Gutenberg.blocks)(e=new o).overrideBlock("object"==typeof BF_Gutenebrg_Export&&BF_Gutenebrg_Export[t]),e.registerBlockType(BF_Gutenberg.blocks[t],BF_Gutenberg.blockFields[t])},extraAttributes:function(e){var t,r,i=BF_Gutenberg.extraAttributes,n={};for(t in i)i.hasOwnProperty(t)&&(-1<((r=i[t]).for_blocks||[]).indexOf(e)&&(n[t]=r));return n},registerSharedAttributes:function(){var r=this;wp.hooks.addFilter("blocks.registerBlockType","betterstudio/shared_settings",function(e,t){t=r.extraAttributes(t);return _.isEmpty(t)||(e.attributes=_.extend(e.attributes,t)),e})},registerSharedFields:function(){wp.hooks.addFilter("editor.BlockEdit","betterstudio/shared_settings",wp.compose.createHigherOrderComponent(function(i){return function(t){t.isSelected&&(n=t);var e=new o(t),r=BF_Gutenberg.stickyFields.filter(function(e){return!(e.exclude_blocks&&-1<e.exclude_blocks.indexOf(t.name))&&(!e.include_blocks||-1<e.include_blocks.indexOf(t.name))});if(!r)return e.element.createElement(i,t);r=e.buildElement(r,{id:"inspector",component:"InspectorControls",args:{key:"inspector"}});return e.element.createElement(e.getComponent("Fragment"),{key:"E1"},r,e.element.createElement(i,t))}}))}}.init(),{activeBlock:function(){return r},blockValues:function(e){if((e=e||this.activeBlock())&&l[e])return JSON.parse(JSON.stringify(l[e]))},blockInstance:function(e){if((e=e||this.activeBlock())&&t[e])return t[e]},blocksInstances:function(){return t}}}();